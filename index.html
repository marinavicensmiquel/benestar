<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Benestar ðŸ’«</title>

  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Benestar">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Poppins", sans-serif;
      color: #222;
      background: url("images/background.png") center/cover no-repeat fixed;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      text-align: center;
    }

    header {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background-color: rgba(255, 255, 255, 0.6);
      border-radius: 0 0 15px 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      backdrop-filter: blur(6px);
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 10;
    }

    .menu-btn {
      font-size: 1rem;
      padding: 8px 14px;
      border: none;
      background: none;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s ease;
      color: #333;
    }
    .menu-btn.active {
      font-weight: bold;
      color: #2e7d32;
      background-color: rgba(46,125,50,0.1);
    }

    select {
      font-size: 0.9rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      padding: 6px 10px;
      background-color: white;
      cursor: pointer;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-top: 70px;
    }

    h2 {
      font-size: 2em;
      color: #2e7d32;
      margin-bottom: 0.5em;
    }

    footer {
      padding-bottom: 30px;
      color: #444;
      font-size: 0.9em;
    }
  </style>
</head>

<body>
  <header>
    <button class="menu-btn active" id="btnBenestar">Benestar</button>
    <button class="menu-btn" id="btnForca">ForÃ§a</button>
    <button class="menu-btn" id="btnPau">Pau</button>
    <label for="freqSelect">FrequÃ¨ncia:</label>
    <select id="freqSelect">
      <option value="10">10 min</option>
      <option value="30">30 min</option>
      <option value="60">1 h</option>
      <option value="120">2 h</option>
      <option value="180">3 h</option>
      <option value="360">6 h</option>
      <option value="720">12 h</option>
    </select>
  </header>

  <main>
    <h2 id="message">Mâ€™estim</h2>
  </main>

  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-messaging-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyARM97493F50pd_QXhR6vRKIn897Q9yKQc",
      authDomain: "benestarpwa.firebaseapp.com",
      projectId: "benestarpwa",
      storageBucket: "benestarpwa.appspot.com",
      messagingSenderId: "487141570676",
      appId: "1:487141570676:web:83af17edc0d0d0b6b5b921"
    };

    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./firebase-messaging-sw.js", { scope: "./" });
    }

    // Messages per theme
    const messages = {
      benestar: [
        "Mâ€™estim", "Mâ€™estimem", "Som una afortunada de la vida",
        "Som agraÃ¯da", "Som feliÃ§", "Som lliure"
      ],
      forca: [
        "Confia en la vida", "Confia en el procÃ©s", "Tot du el seu temps",
        "Vas fent passes", "Vas progressant", "Vas avanÃ§ant"
      ],
      pau: [
        "Creu en el camÃ­", "Ho estÃ s fent molt bÃ©", "Respira",
        "El progrÃ©s es fa caminant", "Vas bÃ©", "PaciÃ¨ncia"
      ]
    };

    let currentTheme = "benestar";
    let currentIndex = 0;
    let intervalMinutes = 10;
    let intervalId = null;

    const messageEl = document.getElementById("message");
    const freqSelect = document.getElementById("freqSelect");

    // Button handlers
    document.getElementById("btnBenestar").onclick = () => setTheme("benestar");
    document.getElementById("btnForca").onclick = () => setTheme("forca");
    document.getElementById("btnPau").onclick = () => setTheme("pau");

    freqSelect.addEventListener("change", () => {
      intervalMinutes = parseInt(freqSelect.value);
      restartLoop();
    });

    function setTheme(theme) {
      currentTheme = theme;
      currentIndex = 0;
      document.querySelectorAll(".menu-btn").forEach(b => b.classList.remove("active"));
      document.getElementById("btn" + capitalize(theme)).classList.add("active");
      updateMessage();
      restartLoop();
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function updateMessage() {
      const msgs = messages[currentTheme];
      messageEl.textContent = msgs[currentIndex];
      currentIndex = (currentIndex + 1) % msgs.length;
    }

    function restartLoop() {
      if (intervalId) clearInterval(intervalId);
      intervalId = setInterval(() => {
        updateMessage();
        showNotification();
      }, intervalMinutes * 60 * 1000);
    }

    // Notifications
    async function showNotification() {
      if (Notification.permission !== "granted") return;
      const msg = messages[currentTheme][currentIndex];
      new Notification("ðŸ’« Benestar", {
        body: msg,
        icon: "icon-192.png"
      });
    }

    // First-time permission request
    window.addEventListener("load", async () => {
      if (Notification.permission === "default") {
        const permission = await Notification.requestPermission();
        if (permission === "granted") {
          const token = await messaging.getToken({
            vapidKey: "BCmbjjP84nLgeIpyqqhfy58e32dVpmnCn0o7-rAWHIPgDBH6rCFp95lU1nvETH94eMoPbcUZlQzuVWzHs9JZX9s"
          });
          await fetch(`https://us-central1-benestarpwa.cloudfunctions.net/subscribeToAll?token=${token}`);
        }
      }
      updateMessage();
      restartLoop();
    });

    messaging.onMessage((payload) => {
      showNotification();
    });
  </script>
</body>
</html>


